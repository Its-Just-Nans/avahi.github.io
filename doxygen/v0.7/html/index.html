<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>avahi: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">avahi
   &#160;<span id="projectnumber">0.7</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('index.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">avahi Documentation</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="choose_api"></a>
Choosing an API</h1>
<p>Avahi provides three programming APIs for integration of mDNS/DNS-SD features into your C progams:</p>
<ul>
<li><b>avahi-core</b>: an API for embedding a complete mDNS/DNS-SD stack into your software. This is intended for developers of embedded appliances only. We dissuade from using this API in normal desktop applications since it is not a good idea to run multiple mDNS stacks simultaneously on the same host. </li>
<li><b>the D-Bus API</b>: an extensive D-Bus interface for browsing and registering mDNS/DNS-SD services using avahi-daemon. We recommend using this API for software written in any language other than C (e.g. Python). </li>
<li><b>avahi-client</b>: a simplifying C wrapper around the D-Bus API. We recommend using this API in C or C++ progams. The D-Bus internals are hidden completely. </li>
<li><b>avahi-gobject</b>: an object-oriented C wrapper based on GLib's GObject. We recommd using this API for GNOME/Gtk programs.</li>
</ul>
<p>All three APIs are very similar, however avahi-core is the most powerful.</p>
<p>In addition to the three APIs described above Avahi supports two compatibility libraries:</p>
<ul>
<li><b>avahi-compat-libdns_sd</b>: the original Bonjour API as documented in the header file "dns_sd.h" by Apple Computer, Inc.</li>
</ul>
<ul>
<li><b>avahi-compat-howl</b>: the HOWL API as released with HOWL 0.9.8 by Porchdog Software.</li>
</ul>
<p>Please note that these compatibility layers are incomplete and generally a waste of resources. We strongly encourage everyone to use our native APIs for newly written programs and to port older programs to avahi-client!</p>
<p>The native APIs (avahi-client and avahi-core) can be integrated into external event loops. We provide adapters for the following event loop implementations:</p>
<ul>
<li><b>avahi-glib</b>: The GLIB main loop as used by GTk+/GNOME</li>
</ul>
<ul>
<li><b>avahi-qt</b>: The Qt main loop as used by Qt/KDE</li>
</ul>
<p>Finally, we provide a high-level Gtk+ GUI dialog called <b>avahi-ui</b> for user-friendly browsing for services.</p>
<p>The doxygen-generated API documentation covers avahi-client (including its auxiliary APIs), the event loop adapters and avahi-ui. For the other APIs please consult the original documentation (for the compatibility APIs) or the header files.</p>
<p>Please note that the doxygen-generated API documentation of the native Avahi API is not complete. A few definitions that are part of the Avahi API have been removed from this documentation, either because they are only relevant in a very few low-level applications or because they are considered obsolete. Please consult the C header files for all definitions that are part of the Avahi API. Please note that these hidden definitions are considered part of the Avahi API and will stay available in the API in the future.</p>
<h1><a class="anchor" id="error_reporting"></a>
Error Reporting</h1>
<p>Some notes on the Avahi error handling:</p>
<ul>
<li>Error codes are negative integers and defined as AVAHI_ERR_xx</li>
<li>If a function returns some kind of non-negative integer value on success, a failure is indicated by returning the error code directly.</li>
<li>If a function returns a pointer of some kind on success, a failure is indicated by returning NULL</li>
<li>The last error number may be retrieved by calling <a class="el" href="client_8h.html#a763d48f8147ab488456705970ea20e44" title="Get the last error number. ">avahi_client_errno()</a></li>
<li>Just like the libc errno variable the Avahi errno is NOT reset to AVAHI_OK if a function call succeeds.</li>
<li>You may convert a numeric error code into a human readable string using <a class="el" href="error_8h.html#acb801f36563fde5d25b0b2b2cae8dfe0" title="Return a human readable error string for the specified error code. ">avahi_strerror()</a></li>
<li>The constructor function <a class="el" href="client_8h.html#a07b2a33a3e7cbb18a0eb9d00eade6ae6" title="Creates a new client instance. ">avahi_client_new()</a> returns the error code in a call-by-reference argument</li>
</ul>
<h1><a class="anchor" id="event_loop"></a>
Event Loop Abstraction</h1>
<p>Avahi uses a simple event loop abstraction layer. A table <a class="el" href="struct_avahi_poll.html" title="Defines an abstracted event polling API. ">AvahiPoll</a> which contains function pointers for user defined timeout and I/O condition event source implementations needs to be passed to <a class="el" href="client_8h.html#a07b2a33a3e7cbb18a0eb9d00eade6ae6" title="Creates a new client instance. ">avahi_client_new()</a>. An adapter for this abstraction layer is available for the GLib main loop in the object AvahiGLibPoll. A simple stand-alone implementation is available under the name AvahiSimplePoll. An adpater for the Qt main loop is available from avahi_qt_poll_get().</p>
<h1><a class="anchor" id="good_publish"></a>
How to Register Services</h1>
<ul>
<li>Subscribe to server state changes. Pass a callback function pointer to <a class="el" href="client_8h.html#a07b2a33a3e7cbb18a0eb9d00eade6ae6" title="Creates a new client instance. ">avahi_client_new()</a>. It will be called whenever the server state changes.</li>
<li>Only register your services when the server is in state AVAHI_SERVER_RUNNING. If you register your services in other server states they might not be accessible since the local host name might not necessarily be established.</li>
<li>Remove your services when the server enters AVAHI_SERVER_COLLISION or AVAHI_SERVER_REGISTERING state. Your services may not be reachable anymore since the local host name is no longer established or is currently in the process of being established.</li>
<li>When registering services, use the following algorithm:<ul>
<li>Create a new entry group (i.e. <a class="el" href="publish_8h.html#abb17598f2b6ec3c3f69defdd488d568c" title="Create a new AvahiEntryGroup object. ">avahi_entry_group_new()</a>)</li>
<li>Add your service(s)/additional RRs/subtypes (e.g. <a class="el" href="publish_8h.html#acb05a7d3d23a3b825ca77cb1c7d00ce4" title="Add a service. ">avahi_entry_group_add_service()</a>)</li>
<li>Commit the entry group (i.e. <a class="el" href="publish_8h.html#a2375338d23af4281399404758840a2de" title="Commit an AvahiEntryGroup. ">avahi_entry_group_commit()</a>)</li>
</ul>
</li>
<li>Subscribe to entry group state changes.</li>
<li>If the entry group enters AVAHI_ENTRY_GROUP_COLLISION state the services of the entry group are automatically removed from the server. You may immediately add your services back to the entry group (but with new names, perhaps using <a class="el" href="alternative_8h.html#ae0b973d05cf10ee64ff755cff0b85d14" title="Find an alternative for the specified service name. ">avahi_alternative_service_name()</a>) and commit again. Please do not free the entry group and create a new one. This would inhibit some traffic limiting algorithms in mDNS.</li>
<li>When you need to modify your services (i.e. change the TXT data or the port number), use the AVAHI_PUBLISH_UPDATE flag. Please do not free the entry group and create a new one. This would inhibit some traffic limiting algorithms in mDNS. When changing just the TXT data avahi_entry_group_update_txt() is a shortcut for AVAHI_PUBLISH_UPDATE. Please note that you cannot use AVAHI_PUBLISH_UPDATE when changing the service name! Renaming a DNS-SD service is identical to deleting and creating a new one, and that's exactly what you should do in that case. First call <a class="el" href="publish_8h.html#a1293bbccf878dbeb9916660022bc71b2" title="Reset an AvahiEntryGroup. ">avahi_entry_group_reset()</a> to remove it and then read it normally.</li>
</ul>
<h1><a class="anchor" id="good_browse"></a>
How to Browse for Services</h1>
<ul>
<li>For normal applications you need to call <a class="el" href="lookup_8h.html#a52d55a5156a7943012d03e6700880d2b" title="Browse for services of a type on the network. ">avahi_service_browser_new()</a> for the service type you want to browse for. Use <a class="el" href="lookup_8h.html#a904611a4134ceb5919f6bb637df84124" title="Create a new service resolver object. ">avahi_service_resolver_new()</a> to acquire service data for a service name.</li>
<li>You can use <a class="el" href="lookup_8h.html#a11e9a5e3dcc5dba1f6fbfd0bfdc30f46" title="Browse for domains on the local network. ">avahi_domain_browser_new()</a> to get a list of announced browsing domains. Please note that not all domains whith services on the LAN are mandatorily announced.</li>
<li>There is no need to subscribe to server state changes.</li>
</ul>
<h1><a class="anchor" id="daemon_dies"></a>
How to Write a Client That Can Deal with Daemon Restarts</h1>
<p>With Avahi it is possible to write client applications that can deal with Avahi daemon restarts. To accomplish that make sure to pass AVAHI_CLIENT_NO_FAIL to <a class="el" href="client_8h.html#a07b2a33a3e7cbb18a0eb9d00eade6ae6" title="Creates a new client instance. ">avahi_client_new()</a>'s flags parameter. That way <a class="el" href="client_8h.html#a07b2a33a3e7cbb18a0eb9d00eade6ae6" title="Creates a new client instance. ">avahi_client_new()</a> will succeed even when the daemon is not running. In that case the object will enter AVAHI_CLIENT_CONNECTING state. As soon as the daemon becomes available the object will enter one of the AVAHI_CLIENT_S_xxx states. Make sure to not create browsers or entry groups before the client object has entered one of those states. As usual you will be informed about state changes with the callback function supplied to <a class="el" href="client_8h.html#a07b2a33a3e7cbb18a0eb9d00eade6ae6" title="Creates a new client instance. ">avahi_client_new()</a>. If the client is forced to disconnect from the server it will enter AVAHI_CLIENT_FAILURE state with <a class="el" href="client_8h.html#a763d48f8147ab488456705970ea20e44" title="Get the last error number. ">avahi_client_errno()</a> == AVAHI_ERR_DISCONNECTED. Free the AvahiClient object in that case (and all its associated objects such as entry groups and browser objects prior to that) and reconnect to the server anew - again with passing AVAHI_CLIENT_NO_FAIL to <a class="el" href="client_8h.html#a07b2a33a3e7cbb18a0eb9d00eade6ae6" title="Creates a new client instance. ">avahi_client_new()</a>.</p>
<p>We encourage implementing this in all software where service discovery is not an integral part of application. e.g. use it in all kinds of background daemons, but not necessarily in software like iChat compatible IM software.</p>
<p>For now AVAHI_CLIENT_NO_FAIL cannot deal with D-Bus daemon restarts.</p>
<h1><a class="anchor" id="domains"></a>
How to Deal Properly with Browsing Domains</h1>
<p>Due to the introduction of wide-area DNS-SD the correct handling of domains becomes more important for Avahi enabled applications. All applications that offer the user a list of services discovered with Avahi should offer some kind of editable drop down box where the user can either enter his own domain or select one of those offered by AvahiDomainBrowser. The default domain to browse should be the one returned by <a class="el" href="client_8h.html#aa6d5c36bc5fd18752b575c15427b52ae" title="Get domain name. ">avahi_client_get_domain_name()</a>. The list of domains returned by AvahiDomainBrowser is assembled by the browsing domains configured in the daemon's configuration file, the domains announced inside the default domain, the domains set with the environment variable $AVAHI_BROWSE_DOMAINS (colon-seperated) on the client side and the domains set in the XDG configuration file ~/.config/avahi/browse-domains on the client side (seperated by newlines). File managers offering some kind of "Network
Neighborhood" folder should show the entries of the default domain right inside that and offer subfolders for the browsing domains returned by AvahiDomainBrowser. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
